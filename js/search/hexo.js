let SearchService=(fn={queryText:null,data:null},fn.template=`<div id="u-search">
  <div class="modal">
    <header class="modal-header" class="clearfix">
      <form id="u-search-modal-form" class="u-search-form" name="uSearchModalForm">
        <input type="text" id="u-search-modal-input" class="u-search-input" />
        <button type="submit" id="u-search-modal-btn-submit" class="u-search-btn-submit">
          <span class="fas fa-search"></span>
        </button>
      </form>
      <a id="u-search-btn-close" class="btn-close"> <span class="fas fa-times"></span> </a>
    </header>
    <main class="modal-body">
      <ul class="modal-results"></ul>
    </main>
  </div>
  <div id="modal-overlay" class="modal-overlay"></div>
</div>
`,fn.init=()=>{let e=document.createElement("div");e.innerHTML+=fn.template,document.body.append(e),document.querySelectorAll(".u-search-form").forEach(e=>{e.addEventListener("submit",fn.onSubmit,!1)});let t=document.querySelector("#u-search-modal-input");t.addEventListener("input",fn.onSubmit),document.querySelector("#u-search-btn-close").addEventListener("click",fn.close,!1),document.querySelector("#modal-overlay").addEventListener("click",fn.close,!1)},fn.onSubmit=e=>{e.preventDefault();var t=e.target.querySelector(".u-search-input");fn.queryText=(t||e.target).value,fn.queryText&&fn.search()},fn.search=async()=>{document.querySelectorAll(".u-search-input").forEach(e=>{e.value=fn.queryText}),document.querySelector("#u-search").style.display="block",fn.data||(fn.data=await fn.fetchData());var e="";e+=fn.buildResultList(data.pages),e+=fn.buildResultList(data.posts),document.querySelector("#u-search .modal-results").innerHTML=e,window.pjax&&pjax.refresh(document.querySelector("#u-search")),document.addEventListener("keydown",function e(t){"Escape"===t.code&&(fn.close(),document.removeEventListener("keydown",e))})},fn.close=()=>{document.querySelector("#u-search").style.display="none"},fn.fetchData=()=>fetch(SearchServiceDataPath).then(e=>e.text()).then(e=>(data=JSON.parse(e),data)),fn.buildResultList=e=>{let t="";return e.forEach(e=>{e.text&&(e.text=e.text.replace(/12345\d*/g,"")),fn.contentSearch(e)&&(t+=fn.buildResult(e.permalink,e.title,e.digest))}),t},fn.contentSearch=n=>{let a=n.title.trim().toLowerCase(),r=n.text.trim().toLowerCase(),s=fn.queryText.trim().toLowerCase().split(/[-\s]+/),l=!1,c,i=-1,u=-1;return a&&r&&s.forEach((e,t)=>{if(c=a.indexOf(e),i=r.indexOf(e),c<0&&i<0?l=!1:(l=!0,i<0&&(i=0),0===t&&(u=i)),l){r=n.text.trim();t=0;let e=0;if(0<=u){t=Math.max(u-40,0),e=0===t?Math.min(200,r.length):Math.min(u+120,r.length);let a=r.substring(t,e);s.forEach(function(e){var t=new RegExp(e,"gi");a=a.replace(t,"<b mark>"+e+"</b>")}),n.digest=a+"......"}else e=Math.min(200,r.length),n.digest=r.trim().substring(0,e)}}),l},fn.buildResult=(e,t,a)=>{e=fn.getUrlRelativePath(e);let n="";return n+="<li>",n+="<a class='result' href='"+e+"?keyword="+fn.queryText+"'>",n+="<span class='title'>"+t+"</span>",""!==a&&(n+="<span class='digest'>"+a+"</span>"),n+="</a>",n+="</li>",n},fn.getUrlRelativePath=function(e){let t=e.split("//");e=t[1].indexOf("/");let a=t[1].substring(e);return-1!=a.indexOf("?")&&(a=a.split("?")[0]),a},{init:()=>{fn.init()},setQueryText:e=>{fn.queryText=e},search:()=>{fn.search()}});Object.freeze(SearchService),SearchService.init(),document.addEventListener("pjax:success",SearchService.init),document.addEventListener("pjax:send",function(){document.querySelector("#u-search").style.display="none"});