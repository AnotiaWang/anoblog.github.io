const RightMenu=(()=>{const c={},d=document.getElementById("rightmenu-wrapper"),u=document.getElementById("rightmenu-content"),m=(document.getElementById("menuDarkBtn"),document.getElementById("printHtml")),g=document.getElementById("menuMusic"),v=document.getElementById("readingModel"),t=document.getElementById("read_bkg"),y=document.querySelectorAll(".menuLoad-Content"),o=document.querySelector(".menu-Option"),p=document.querySelector('.menu-Option[data-fn-type="copyText"]'),h=document.querySelector('.menu-Option[data-fn-type="copyPaste"]'),b=document.querySelector('.menu-Option[data-fn-type="copySelect"]'),f=document.querySelector('.menu-Option[data-fn-type="copyCut"]'),S=document.querySelector('.menu-Option[data-fn-type="copyHref"]'),M=document.querySelector('.menu-Option[data-fn-type="copySrc"]'),w=document.querySelector('.menu-Option[data-fn-type="copyImg"]'),C=document.querySelector('.menu-Option[data-fn-type="openTab"]'),q=/^((https|http)?:\/\/)+[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/;return c.init=()=>{c.visible(g,!1),c.visible(o,!1),t&&t.parentNode.removeChild(t);const e=document.createElement("div");e.className="common_read_bkg common_read_hide",e.id="read_bkg",window.document.body.appendChild(e)},c.initEvent=()=>{window.document.oncontextmenu=e=>e.ctrlKey||document.body.offsetWidth<=500?(c.hideMenu(),!0):c.popMenu(e),d.oncontextmenu=e=>(e.stopPropagation(),e.preventDefault(),!1),window.removeEventListener("blur",c.hideMenu),document.body.removeEventListener("click",c.hideMenu),window.addEventListener("blur",c.hideMenu),document.body.addEventListener("click",c.hideMenu)},c.popMenu=t=>{var o=t.clientX,n=t.clientY,i=document.documentElement.clientWidth||document.body.clientWidth,l=document.documentElement.clientHeight||document.body.clientHeight;try{c.setMenuItem(t),c.visible(d),d.focus(),d.style.zIndex="-2147483648";var r=u.offsetWidth,a=u.offsetHeight,s=i<o+r?o-r+10:o;let e=l<n+a?n-a+10:n;e=l<n+a&&e<a&&n<a?e+(l-a-e-10):e,d.style.left=s+"px",d.style.top=e+"px",d.style.zIndex="2147483648"}catch(e){return d.blur(),console.error(e),!0}return!1},c.setMenuItem=e=>{let t=!1;const o=e.target,n=window.getSelection().toString();if(c.visible(C,!1),"input"===o.tagName.toLowerCase()||"textarea"===o.tagName.toLowerCase()){const s=o.value;0<s.length?(c.visible(b),b.onclick=()=>{e.preventDefault(),o.select()}):c.visible(b,!1),n?(c.visible(f),f.onclick=()=>{var e=o.selectionStart,t=o.selectionEnd;c.copyString(n),o.value=s.substring(0,e)+s.substring(t,s.length),o.selectionStart=e,o.selectionEnd=e,o.focus()}):c.visible(f,!1),c.readClipboard().then(e=>{e?(c.visible(h),h.onclick=()=>{c.insertAtCaret(o,e)}):c.visible(h,!1)}).catch(e=>{console.error(e),c.visible(h,!1)})}else c.visible(b,!1),c.visible(h,!1),c.visible(f,!1);const i=o.href;i&&q.test(i)?(t=!0,c.visible(S),c.visible(C),S&&(S.onclick=()=>{c.copyString(i)}),C.onclick=()=>{window.open(i)}):c.visible(S,!1);const l=o.currentSrc;l&&q.test(l)?(t=!0,c.visible(M),c.visible(C),M.onclick=()=>{c.copyString(l)},C.onclick=()=>{window.open(l)}):c.visible(M,!1),l&&q.test(l)&&l.trimEnd().endsWith(".png")?(t=!0,c.visible(w),w.onclick=()=>{c.writeClipImg(e,e=>{e&&volantis.messageRightMenu.enable&&volantis.message("系统提示","图片复制成功！",{icon:volantis.rightMenu.faicon+" fa-images"})},e=>{volantis.messageRightMenu.enable&&volantis.message("系统提示","复制失败："+e,{icon:volantis.rightMenu.faicon+" fa-exclamation-square red"})})}):c.visible(w,!1),n?(t=!0,c.visible(p),p.onclick=()=>{c.copyString(n)}):c.visible(p,!1);var r=document.querySelector("#post.article")||null;const a=window.location.pathname;r?(c.visible(m),c.visible(v),m&&(m.onclick=()=>{window.location.pathname===a?volantis.messageRightMenu.enable&&volantis.question("",'是否打印当前页面？<br><em style="font-size: 80%">建议打印时勾选背景图形</em><br>',{},()=>{c.printHtml()}):c.hideMenu()}),v&&(v.onclick=()=>{window.location.pathname,a,c.readingModel()})):(c.visible(m,!1),c.visible(v,!1)),volantis.APlayerController&&"undefined"!=typeof MainAPlayer&&"play"===MainAPlayer.APlayer.status?(t=!0,c.visible(g)):c.visible(g,!1),y.forEach(e=>{c.visible(e,!t)}),1==volantis.rightMenu.music&&volantis.APlayerController.APlayerLoaded&&MainAPlayer.checkAPlayer()},c.hideMenu=()=>{c.visible(d,!1)},c.copyString=e=>{VolantisApp.writeClipText(e).then(()=>{volantis.messageCopyright&&volantis.messageCopyright.enable&&volantis.messageRightMenu.enable&&volantis.message(volantis.messageCopyright.title,volantis.messageCopyright.message,{icon:volantis.messageCopyright.icon})}).catch(e=>{volantis.messageRightMenu.enable&&volantis.message("系统提示",e,{icon:volantis.rightMenu.faicon+" fa-exclamation-square red"})})},c.writeClipText=t=>{try{return navigator.clipboard.writeText(t).then(()=>Promise.resolve()).catch(e=>Promise.reject(e))}catch(e){const n=document.createElement("input");n.setAttribute("readonly","readonly"),document.body.appendChild(n),n.setAttribute("value",t),n.select();try{var o=document.execCommand("copy");return document.body.removeChild(n),o&&"unsuccessful"!==o?Promise.resolve():Promise.reject("复制文本失败!")}catch(e){return document.body.removeChild(n),Promise.reject("当前浏览器不支持复制功能，请检查更新或更换其他浏览器操作!")}}},c.writeClipImg=async function(t,o,n){var e=!0===volantis.rightMenu.customPicUrl?t.target.currentSrc.replace(volantis.rightMenu.picOld,volantis.rightMenu.picNew):t.target.currentSrc,t=t.target.parentElement;try{const l=await fetch(e);var i=await l.blob();await navigator.clipboard.write([new ClipboardItem({[i.type]:i})]).then(()=>{o(!0)},e=>{console.error("图片复制失败：",e),n(e)})}catch(e){i=document;try{if(i.body.createTextRange){const r=document.body.createTextRange();r.moveToElementText(t),r.select()}else if(window.getSelection){const a=window.getSelection(),s=document.createRange();s.selectNodeContents(t),a.removeAllRanges(),a.addRange(s)}document.execCommand("copy"),window.getSelection().removeAllRanges(),o(!1)}catch(e){console.error(e),n("不支持复制当前图片！")}}},c.readClipboard=async()=>{var e=await navigator.permissions.query({name:"clipboard-read"});return"granted"===e.state||"prompt"===e.state?navigator.clipboard.readText().then(e=>e).catch(e=>Promise.reject(e)):Promise.reject(e)},c.insertAtCaret=(e,t)=>{var o,n=e.selectionStart,i=e.selectionEnd;document.selection?(e.focus(),document.selection.createRange().text=t,e.focus()):n||"0"==n?(o=e.scrollTop,e.value=e.value.substring(0,n)+t+e.value.substring(i,e.value.length),e.focus(),e.selectionStart=n+t.length,e.selectionEnd=n+t.length,e.scrollTop=o):(e.value+=t,e.focus())},c.printHtml=()=>{volantis.isReadModel&&c.readingModel(),!0===volantis.rightMenu.defaultStyles&&(c.setAttribute("details","open","true"),c.remove(".cus-article-bkg"),c.remove(".iziToast-overlay"),c.remove(".iziToast-wrapper"),c.remove(".prev-next"),c.remove("footer"),c.remove("#l_header"),c.remove("#l_cover"),c.remove("#l_side"),c.remove("#comments"),c.remove("#s-top"),c.remove("#BKG"),c.remove("#rightmenu-wrapper"),c.remove(".nav-tabs"),c.remove(".parallax-mirror"),c.remove(".new-meta-item.share"),c.remove("div.footer"),c.setStyle("body","backgroundColor","unset"),c.setStyle("#l_main","width","100%"),c.setStyle("#post","boxShadow","none"),c.setStyle("#post","background","none"),c.setStyle("#post","padding","0"),c.setStyle("h1","textAlign","center"),c.setStyle("h1","fontWeight","600"),c.setStyle("h1","fontSize","2rem"),c.setStyle("h1","marginBottom","20px"),c.setStyle(".tab-pane","display","block"),c.setStyle(".tab-content","borderTop","none"),c.setStyle(".highlight>table pre","whiteSpace","pre-wrap"),c.setStyle(".highlight>table pre","wordBreak","break-all"),c.setStyle(".fancybox img","height","auto"),c.setStyle(".fancybox img","weight","auto")),!0===volantis.rightMenu.printJs&&volantis.rightMenu.printJsFun(),setTimeout(()=>{window.print(),document.body.innerHTML="",window.location.reload()},50)},c.readingModel=()=>{var e;"function"==typeof ScrollReveal&&ScrollReveal().clean("#comments"),c.fadeToggle(document.querySelector("#l_header")),c.fadeToggle(document.querySelector("footer")),c.fadeToggle(document.querySelector("#s-top")),c.fadeToggle(document.querySelector(".article-meta#bottom")),c.fadeToggle(document.querySelector(".prev-next")),c.fadeToggle(document.querySelector("#l_side")),c.fadeToggle(document.querySelector("#comments")),c.toggleClass(document.querySelector("#l_main"),"common_read"),c.toggleClass(document.querySelector("#l_main"),"common_read_main"),c.toggleClass(document.querySelector("#l_body"),"common_read"),c.toggleClass(document.querySelector("#safearea"),"common_read"),c.toggleClass(document.querySelector("#pjax-container"),"common_read"),c.toggleClass(document.querySelector("#read_bkg"),"common_read_hide"),c.toggleClass(document.querySelector("h1"),"common_read_h1"),c.toggleClass(document.querySelector("#post"),"post_read"),c.toggleClass(document.querySelector("#l_cover"),"read_cover"),c.toggleClass(document.querySelector(".widget.toc-wrapper"),"post_read"),volantis.isReadModel=void 0===volantis.isReadModel||!volantis.isReadModel,volantis.isReadModel?(e={backgroundColor:"var(--color-read-post)",icon:volantis.rightMenu.faicon+" fa-book-reader",time:5e3},volantis.messageRightMenu.enable&&volantis.message("系统提示","阅读模式已开启，您可以点击屏幕空白处退出。",e),document.querySelector("#l_body").removeEventListener("click",c.readingModel),document.querySelector("#l_body").addEventListener("click",e=>{c.hasClass(e.target,"common_read")&&c.readingModel()})):(document.querySelector("#l_body").removeEventListener("click",c.readingModel),document.querySelector("#post").removeEventListener("click",c.readingModel))},c.visible=(e,t=!0)=>{e&&(e.style.display=!0===t?"block":"none")},c.remove=e=>{const t=document.querySelectorAll(e);t.forEach(e=>{e.remove()})},c.setAttribute=(e,t,o)=>{const n=document.querySelectorAll(e);n.forEach(e=>{e.setAttribute(t,o)})},c.setStyle=(e,t,o)=>{const n=document.querySelectorAll(e);n.forEach(e=>{e.style[t]=o})},c.fadeIn=e=>{if(e)return e.style.visibility="visible",e.style.opacity=1,e.style.display="block",e.style.transition="all 0.5s linear",e},c.fadeOut=e=>{if(e)return e.style.visibility="hidden",e.style.opacity=0,e.style.display="none",e.style.transition="all 0.5s linear",e},c.fadeToggle=e=>{if(e)return e="hidden"==e.style.visibility?c.fadeIn(e):c.fadeOut(e)},c.hasClass=(e,t)=>{if(e)return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},c.addClass=(e,t)=>{if(e)return e.classList.add(t),e},c.removeClass=(e,t)=>{if(e)return e.classList.remove(t),e},c.toggleClass=(e,t)=>{if(e)return c.hasClass(e,t)?c.removeClass(e,t):c.addClass(e,t),e},{init:(e=!1)=>{c.init(),c.initEvent(),e&&volantis.messageRightMenu.enable&&volantis.message("系统提示","自定义右键注册成功。")},destroy:(e=!1)=>{c.hideMenu(),window.document.oncontextmenu=()=>!0,e&&volantis.messageRightMenu.enable&&volantis.message("系统提示","自定义右键注销成功。")},hideMenu:()=>{c.hideMenu()},readingModel:()=>{c.readingModel()}}})();Object.freeze(RightMenu),volantis.requestAnimationFrame(()=>{"loading"!==document.readyState?(RightMenu.init(),volantis.pjax.send(()=>{RightMenu.hideMenu()})):document.addEventListener("DOMContentLoaded",function(){RightMenu.init(),volantis.pjax.send(()=>{RightMenu.hideMenu()})})});